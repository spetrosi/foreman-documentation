[id='configuring-host-based-authentication-control_{context}']

= Configuring Host-Based Authentication Control

HBAC rules define which machine within the domain an IdM user is allowed to access. You can configure HBAC on the IdM server to prevent selected users from accessing the Satellite Server. With this approach, you can prevent Satellite from creating database entries for users that are not allowed to log in. For more information on HBAC, see link:https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/configuring-host-access.html[Configuring Host-Based Access Control] in the _Red{nbsp}Hat Enterprise{nbsp}Linux{nbsp}7 Linux Domain Identity, Authentication, and Policy_ guide.

On the IdM server, configure Host-Based Authentication Control (HBAC).  

.Procedure

. On the IdM server, to authenticate, enter the following command and enter your password when prompted:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# kinit _admin_
----

. To verify that you have authenticated, enter the following command:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# klist
----

. Create HBAC service and rule on the IdM server and link them together. The following examples use the PAM service name _satellite-prod_. Execute the following commands on the IdM server:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# ipa hbacsvc-add satellite-prod
# ipa hbacrule-add allow_satellite_prod
# ipa hbacrule-add-service allow_satellite_prod --hbacsvcs=satellite-prod
----

. Add the user who is to have access to the service satellite-prod, and the hostname of the Satellite Server:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# ipa hbacrule-add-user allow_satellite_prod --user=_username_
# ipa hbacrule-add-host allow_satellite_prod --hosts=_the-satellite-fqdn_
----
+
Alternatively, host groups and user groups can be added to the _allow_satellite_prod_ rule.

. To check the status of the rule, execute:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# ipa hbacrule-find satellite-prod
# ipa hbactest --user=_username_ --host=_the-satellite-fqdn_ --service=satellite-prod
----

. Ensure the allow_all rule is disabled on the IdM server. For instructions on how to do so without disrupting other services see the link:https://access.redhat.com/solutions/67895[How to configure HBAC rules in IdM] article on the Red{nbsp}Hat Customer Portal.

. Configure the IdM integration with the Satellite Server as described in xref:configuring-idm-authentication-on-satellite-server_{context}[]. On the Satellite Server, define the PAM service as root:
+
[options="nowrap" subs="+quotes,verbatim"]
----
# satellite-installer --foreman-pam-service=satellite-prod
----
