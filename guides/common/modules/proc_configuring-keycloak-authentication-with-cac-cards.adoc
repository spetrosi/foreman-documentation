[id="configuring-keycloak-authentication-with-cac-cards_{context}"]
= Configuring {Keycloak} Authentication With CAC Cards

Use this procedure to configure {Project} for {Keycloak} authentication with CAC cards.

.Configuring User's OS and Browser

. On the system from where you want to log in, install required packages:
+
[options="nowrap", subs="+quotes,attributes"]
----
{package-install-project} opensc -y
----
. Install the Firefox browser if not installed.
. Launch Firefox and navigate to *Preferences*.
. Click the *Privacy and Security* tab.
. Click the *Security Devices* button.
. Click *Load*.
. In the Load PKCS#11 Device Driver window, in the *Module Name* field, enter a name for this device.
. In the *Module filename* field, enter */usr/lib64/pkcs11/opensc-pkcs11.so*.
. Click *OK*.
. If the CAC card is connected to system, restart the `pcscd` service.
. In Firefox, log in to {Project}.
. When prompted, enter the PIN of the CAC card.
. Choose the certificate for authentication.
Browser verifies this certificate to {Keycloak}.
Once authenticated, browser redirects you back to {Project} and log you in.

.Configuring {Keycloak}

. In the {Keycloak} web UI, navigate to the *Authentication* tab.
. From the *Flows* list, select *Browser*.
. Click the *Copy* button to copy this flow.
. In the *Copy Authentication Flow* window, enter a new name for the flow and click *OK*.
. In the copied flow, delete *Username Password Form* and *OTP Form* entries.
. Click *Add execution*.
. From the *Provider* list, select *X509/Validate Username Form*.
. Click *Save*.
. In the *X509/Validate Username Form* raw, select *ALTERNATIVE*.
. In the *X509/Validate Username Form* raw, click *Actions* > *Config*.
. In the *Alias* field, enter a name for this configuration.
. From the *User Identity Source* list, select *Subjectâ€™s Common Name*,
. From the *User mapping method* list, select *Username or Email*.
. Click *Save*.
. Navigate to *Authentication* > *Bindings*.
. From the *Browser Flow* list, select the created flow.
