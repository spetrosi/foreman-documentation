[id="configuring-project-with-keycloak-for-totp-authentication_{context}"]
= Configuring {Project} with {Keycloak} for TOTP Authentication

Use this procedure to configure {Project} to use {Keycloak} as an OpenID provider for external authentication with Time-based One-time Password (TOTP).

.Prerequisites

* {Project} configured with {Keycloak} external authentication.

.Configuring User Federation Mappers

. In the {Keycloak} web UI, navigate to the {Project} realm.
. Click *User Federation* and click the user federation you created for {Project}.
. Click the *Mappers* tab.
. Click the *Create* button to create and configure the following 7 mappers:
+
.Mappers
|===
|Name |Mapper Type |User Model Attribute |LDAP Attribute |Read Only |Always Read Value From LDAP |Is Mandatory In LDAP |Is Binary Attribute |Password Policy Hints Enabled
|username |user-attribute-ldap-mapper |username |sAMAccountName |ON |ON |ON |OFF |-
|MSAD-account controls |mcad-user-account-control-mapper |- |- |- |- |- |- |ON
|last name |user-attribute-ldap-mapper |lastName |sn |ON |ON |ON |OFF |-
|first name |user-attribute-ldap-mapper |firstName |givenName |ON |ON |ON |OFF |-
|modify date |user-attribute-ldap-mapper |modifyTimestamp |whenChanged |ON |ON |OFF |OFF |-
|email |user-attribute-ldap-mapper |email |mail |ON |ON |OFF |OFF |-
|creation date |user-attribute-ldap-mapper |creationTimestamp |whenCreated |ON |ON |OFF |OFF |-
|===

.Configuring TOTP Authentication

. In the {Keycloak} web UI, navigate to *Authentication*, and click the *OTP Policy* tab.
. Ensure that the *Supported Applications* field includes FreeOTP or Google Authenticator.
. Configure the OTP settings to suit your requirements.
. Optional: If you want to use TOTP authentication as a default authentication method for all users, click the *Flows* tab, and to the right of the *OTP Form* setting, select *REQUIRED*.
. Click the *Required Actions* tab.
. To the right of the *Configure OTP* row, select the *Default Action* check box
. To verify that OTP authentication works, log in to {Project}, {Project} redirects you to SSO login screen.
. Enter your username and password, and click *Log In*.
. Because this is the first attempt to log in, {Keycloak} requests you to configure your client by scanning the barcode and entering the pin displayed.
. After configuring your client and entering a valid PIN, you are redirected to {Project} and
logged in.
